<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Lotus client</title>
    </head>
    <body>
    <script>
        let websocket = new WebSocket('ws://localhost:8123');
        let open = new Promise(resolve => websocket.onopen = resolve);
        let messages = [];

        websocket.binaryType = 'arraybuffer';

        websocket.onmessage = msg => {
            messages.push(new Uint8Array(msg.data));
        };

        window.send_message = function(bytes) {
            open.then(() => websocket.send(bytes));
        };

        window.read_message = function() {
            return messages.shift();
        };

        window.log = function(str) {
            console.log(str);
        };

    </script>
    <script type="module">
        import init, { start, update } from "./client/pkg/lotus_client.js";

        init().then(() => {
            start();

            setInterval(update, 100);
        });
    </script>
    </body>
</html>